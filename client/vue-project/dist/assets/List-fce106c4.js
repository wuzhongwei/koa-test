import{d as j,a as p,r as y,b as r,o as A,c as I,e as C,f as e,w as n,g as a,h as J,i as f,q as O,E as k,x as Q}from"./index-bbd3d47d.js";import{s as _}from"./request-aa49ef4b.js";const W={class:"mt-4"},X={class:"mt10"},Y={class:"dialog-footer"},te=j({__name:"List",setup(Z){const v=p(""),g=p(!1);let c=p([]),w=p(1),U=p(4),b=p(0),o=y({integral:0,name:"",phone:"",glasses:"",eyeglass:"",sunglasses:"",oldGlasses:""});const B=s=>{_({url:"/api/remove",method:"post",data:{id:s}}).then(({data:l})=>{k({type:"success",message:"删除成功"})})},$=(s,l)=>{o=y({...l}),g.value=!0},G=(s,l)=>{O.confirm("确认删除?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{c.value=c.value.filter(u=>u.id!==l.id),B(l.id)}).catch(()=>{})},T=s=>{w.value=s,V()},V=()=>{_({url:"/api/userList",method:"get",params:{currentPage:w.value,pageSizes:U.value}}).then(({data:s})=>{c.value=s.list,b.value=s.total})},F=()=>{_({url:"/api/userList",method:"get",params:{phone:v.value}}).then(({data:s})=>{c.value=s.list,b.value=s.total})};V();let h=!0,z=null;const x=p(),E=()=>{},L=y({name:[{required:!0,message:"姓名不能为空",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空",trigger:"blur"}]}),N=s=>{s&&(g.value=!1)},q=()=>{},K=s=>{s&&(clearTimeout(z),z=setTimeout(()=>{h=!0},200),h&&(h=!1,s.validate(l=>{if(l)_({url:"/api/update",method:"post",data:{...o}}).then(u=>{g.value=!1,u.code===0?(k.success("修改成功"),V()):k.error("修改失败")});else return console.log("error submit!"),!1})))};return(s,l)=>{const u=r("el-button"),i=r("el-input"),d=r("el-table-column"),D=r("el-table"),H=r("el-pagination"),m=r("el-form-item"),M=r("el-input-number"),P=r("el-form"),R=r("el-dialog");return A(),I("div",null,[C("div",W,[e(i,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=t=>v.value=t),placeholder:"请输入姓名或者手机号搜索",class:"input-with-select",onKeyup:J(F,["enter"])},{append:n(()=>[e(u,{icon:a(Q),onClick:F},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"])]),e(D,{border:"",data:a(c),style:{width:"100%"}},{default:n(()=>[e(d,{prop:"name",label:"姓名"}),e(d,{prop:"phone",label:"手机号"}),e(d,{prop:"glasses",label:"眼镜架"}),e(d,{prop:"eyeglass",label:"眼镜片"}),e(d,{prop:"sunglasses",label:"太阳镜"}),e(d,{prop:"oldGlasses",label:"老花镜"}),e(d,{prop:"integral",label:"积分"}),e(d,{label:"操作",width:"150"},{default:n(t=>[e(u,{size:"small",onClick:S=>$(t.$index,t.row)},{default:n(()=>[f("编辑")]),_:2},1032,["onClick"]),e(u,{size:"small",type:"danger",onClick:S=>G(t.$index,t.row)},{default:n(()=>[f("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),C("div",X,[e(H,{"page-size":a(U),class:"mt10",background:"",layout:"prev, pager, next",total:a(b),onCurrentChange:T},null,8,["page-size","total"])]),e(R,{onClose:E,modelValue:g.value,"onUpdate:modelValue":l[10]||(l[10]=t=>g.value=t),title:"修改","close-on-click-modal":!1},{footer:n(()=>[C("span",Y,[e(u,{onClick:l[8]||(l[8]=t=>N(x.value))},{default:n(()=>[f("取消")]),_:1}),e(u,{type:"primary",onClick:l[9]||(l[9]=t=>K(x.value))},{default:n(()=>[f(" 确认 ")]),_:1})])]),default:n(()=>[e(P,{ref_key:"ruleFormRef",ref:x,model:a(o),"status-icon":"",rules:L,"label-width":"120px",class:"demo-ruleForm"},{default:n(()=>[e(m,{label:"姓名",prop:"name"},{default:n(()=>[e(i,{modelValue:a(o).name,"onUpdate:modelValue":l[1]||(l[1]=t=>a(o).name=t),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(m,{label:"手机号",prop:"phone"},{default:n(()=>[e(i,{modelValue:a(o).phone,"onUpdate:modelValue":l[2]||(l[2]=t=>a(o).phone=t),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(m,{label:"眼镜架",prop:"glasses"},{default:n(()=>[e(i,{modelValue:a(o).glasses,"onUpdate:modelValue":l[3]||(l[3]=t=>a(o).glasses=t),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(m,{label:"眼镜片",prop:"eyeglass"},{default:n(()=>[e(i,{modelValue:a(o).eyeglass,"onUpdate:modelValue":l[4]||(l[4]=t=>a(o).eyeglass=t),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(m,{label:"太阳镜",prop:"sunglasses"},{default:n(()=>[e(i,{modelValue:a(o).sunglasses,"onUpdate:modelValue":l[5]||(l[5]=t=>a(o).sunglasses=t),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(m,{label:"老花镜",prop:"oldGlasses"},{default:n(()=>[e(i,{modelValue:a(o).oldGlasses,"onUpdate:modelValue":l[6]||(l[6]=t=>a(o).oldGlasses=t),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(m,{label:"积分",prop:"integral"},{default:n(()=>[e(M,{modelValue:a(o).integral,"onUpdate:modelValue":l[7]||(l[7]=t=>a(o).integral=t),min:1,"controls-position":"right",onChange:q},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{te as default};
