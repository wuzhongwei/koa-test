import{d as j,a as p,r as y,b as d,o as A,c as I,e as C,f as e,w as s,g as t,h as J,i as _,q as O,E as k,ae as Q}from"./index-a72879b9.js";import{s as c}from"./request-ed690f3a.js";const W={class:"mt-4"},X={class:"mt10"},Y={class:"dialog-footer"},ae=j({__name:"List",setup(Z){const v=p(""),g=p(!1);let f=p([]),U=p(1),w=p(4),b=p(0),o=y({integral:0,name:"",phone:"",glasses:"",eyeglass:"",sunglasses:"",oldGlasses:"",degrees:""});const B=n=>{c({url:"/api/remove",method:"post",data:{id:n}}).then(({data:l})=>{k({type:"success",message:"删除成功"})})},$=(n,l)=>{o=y({...l}),g.value=!0},G=(n,l)=>{O.confirm("确认删除?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{f.value=f.value.filter(u=>u.id!==l.id),B(l.id)}).catch(()=>{})},T=n=>{U.value=n,V()},V=()=>{c({url:"/api/userList",method:"get",params:{currentPage:U.value,pageSizes:w.value}}).then(({data:n})=>{f.value=n.list,b.value=n.total})},F=()=>{c({url:"/api/userList",method:"get",params:{phone:v.value}}).then(({data:n})=>{f.value=n.list,b.value=n.total})};V();let h=!0,z=null;const x=p(),E=()=>{},L=y({name:[{required:!0,message:"姓名不能为空",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空",trigger:"blur"}]}),N=n=>{n&&(g.value=!1)},q=()=>{},K=n=>{n&&(clearTimeout(z),z=setTimeout(()=>{h=!0},200),h&&(h=!1,n.validate(l=>{if(l)c({url:"/api/update",method:"post",data:{...o}}).then(u=>{g.value=!1,u.code===0?(k.success("修改成功"),V()):k.error("修改失败")});else return console.log("error submit!"),!1})))};return(n,l)=>{const u=d("el-button"),m=d("el-input"),r=d("el-table-column"),D=d("el-table"),H=d("el-pagination"),i=d("el-form-item"),M=d("el-input-number"),P=d("el-form"),R=d("el-dialog");return A(),I("div",null,[C("div",W,[e(m,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=a=>v.value=a),placeholder:"请输入姓名或者手机号搜索",class:"input-with-select",onKeyup:J(F,["enter"])},{append:s(()=>[e(u,{icon:t(Q),onClick:F},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"])]),e(D,{border:"",data:t(f),style:{width:"100%"}},{default:s(()=>[e(r,{prop:"name",label:"姓名"}),e(r,{prop:"phone",label:"手机号"}),e(r,{prop:"glasses",label:"眼镜架"}),e(r,{prop:"eyeglass",label:"眼镜片"}),e(r,{prop:"sunglasses",label:"太阳镜"}),e(r,{prop:"oldGlasses",label:"老花镜"}),e(r,{prop:"degrees",label:"度数"}),e(r,{prop:"integral",label:"积分"}),e(r,{label:"操作",width:"150"},{default:s(a=>[e(u,{size:"small",onClick:S=>$(a.$index,a.row)},{default:s(()=>[_("编辑")]),_:2},1032,["onClick"]),e(u,{size:"small",type:"danger",onClick:S=>G(a.$index,a.row)},{default:s(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),C("div",X,[e(H,{"page-size":t(w),class:"mt10",background:"",layout:"prev, pager, next",total:t(b),onCurrentChange:T},null,8,["page-size","total"])]),e(R,{onClose:E,modelValue:g.value,"onUpdate:modelValue":l[11]||(l[11]=a=>g.value=a),title:"修改","close-on-click-modal":!1},{footer:s(()=>[C("span",Y,[e(u,{onClick:l[9]||(l[9]=a=>N(x.value))},{default:s(()=>[_("取消")]),_:1}),e(u,{type:"primary",onClick:l[10]||(l[10]=a=>K(x.value))},{default:s(()=>[_(" 确认 ")]),_:1})])]),default:s(()=>[e(P,{ref_key:"ruleFormRef",ref:x,model:t(o),"status-icon":"",rules:L,"label-width":"120px",class:"demo-ruleForm"},{default:s(()=>[e(i,{label:"姓名",prop:"name"},{default:s(()=>[e(m,{modelValue:t(o).name,"onUpdate:modelValue":l[1]||(l[1]=a=>t(o).name=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"手机号",prop:"phone"},{default:s(()=>[e(m,{modelValue:t(o).phone,"onUpdate:modelValue":l[2]||(l[2]=a=>t(o).phone=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"眼镜架",prop:"glasses"},{default:s(()=>[e(m,{modelValue:t(o).glasses,"onUpdate:modelValue":l[3]||(l[3]=a=>t(o).glasses=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"眼镜片",prop:"eyeglass"},{default:s(()=>[e(m,{modelValue:t(o).eyeglass,"onUpdate:modelValue":l[4]||(l[4]=a=>t(o).eyeglass=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"太阳镜",prop:"sunglasses"},{default:s(()=>[e(m,{modelValue:t(o).sunglasses,"onUpdate:modelValue":l[5]||(l[5]=a=>t(o).sunglasses=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"老花镜",prop:"oldGlasses"},{default:s(()=>[e(m,{modelValue:t(o).oldGlasses,"onUpdate:modelValue":l[6]||(l[6]=a=>t(o).oldGlasses=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"度数",prop:"degrees"},{default:s(()=>[e(m,{modelValue:t(o).degrees,"onUpdate:modelValue":l[7]||(l[7]=a=>t(o).degrees=a),maxlength:"100"},null,8,["modelValue"])]),_:1}),e(i,{label:"积分",prop:"integral"},{default:s(()=>[e(M,{modelValue:t(o).integral,"onUpdate:modelValue":l[8]||(l[8]=a=>t(o).integral=a),min:1,"controls-position":"right",onChange:q},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{ae as default};
